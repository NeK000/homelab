services:
  karakeep-chrome:
    image: gcr.io/zenika-hub/alpine-chrome:123
    container_name: karakeep-chrome
    restart: unless-stopped
    labels:
      net.unraid.docker.icon: https://raw.githubusercontent.com/Collectathon/unraid-templates/main/icons/hoarder.png
    command:
      - --no-sandbox
      - --disable-gpu
      - --disable-dev-shm-usage
      - --remote-debugging-address=0.0.0.0
      - --remote-debugging-port=9222
      - --hide-scrollbars
  karakeep-meilisearch:
    image: getmeili/meilisearch:v1.35.0
    container_name: karakeep-meilisearch
    restart: unless-stopped
    labels:
      net.unraid.docker.icon: https://raw.githubusercontent.com/Collectathon/unraid-templates/main/icons/hoarder.png
    environment:
      - MEILI_NO_ANALYTICS=true
      - MEILI_MASTER_KEY=${MEILI_MASTER_KEY}
    volumes:
      - "${PATH_APPDATA_UNRAID}/karakeep-meili:/meili_data:rw"
  karakeep:
    image: ghcr.io/karakeep-app/karakeep:release
    container_name: karakeep
    restart: unless-stopped
    labels:
      tsdproxy.enable: "true"
      tsdproxy.name: "karakeep"
      tsdproxy.ephemeral: "true"
      tsdproxy.container_port: "3006"
      net.unraid.docker.managed: dockerman
      net.unraid.docker.webui: http://[IP]:[PORT:3006]
      net.unraid.docker.icon: https://raw.githubusercontent.com/Collectathon/unraid-templates/main/icons/hoarder.png
    environment:
      - MEILI_ADDR=http://karakeep-meilisearch:7700
      - BROWSER_WEB_URL=http://karakeep-chrome:9222
      - DATA_DIR=/data
      - NEXTAUTH_URL=${KARAKEEP_NEXTAUTH_URL}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}
    volumes:
      - "${PATH_APPDATA_UNRAID}/karakeep:/data:rw"
    ports:
      - "3006:3000"
